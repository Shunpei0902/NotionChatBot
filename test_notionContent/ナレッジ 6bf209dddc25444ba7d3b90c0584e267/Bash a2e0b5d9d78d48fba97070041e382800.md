# Bash

タグ: minishell
作成日: 2024年4月7日
親アイテム: 💻IT (%F0%9F%92%BBIT%20ef34be92b83548d18faba8d778178b3a.md)

### 用語定義

**ブランク (blank)**

空白文字またはタブ文字

**単語 (word)**

シェルが 1 単位とみなす文字の並び。 **トークン (token)** とも言われる。

**名前 (name)**

英数字とアンダースコア文字だけから構成され、 かつ最初の文字が英字かアンダースコア文字である *単語*。

**識別子 (identifier)** とも言われる。

- *メタ文字 (metacharacter)**クォートされていない場合に、単語区切りとなる文字。

以下の文字のうちのいずれか

```bash
**| & ; ( ) < > space tab**

```

**制御演算子 (control operator)**

制御機能を持つ *トークン*。

以下のシンボルのうちのいずれか

```bash
**|| & && ; ;; ( ) | |& <newline>**

```

### パラメータ

パラメータは、値を保持することができるエンティティの総称

- 名前付き変数（例：`myVar=123`）
- 位置パラメータ（スクリプトや関数に渡される引数。例：`$1`, `$2`...）
- 特別なパラメータ（例：`$*`, `$@`, `$#`, `$$`, `$?`など）

パラメータは値を格納するための「容器」であり、変数、位置パラメータ、特別なシェルパラメータなど、さまざまな形態を取り得る

### 変数

変数は、名前（識別子）を通じてアクセスされる値を保持するパラメータの一種

ユーザーが定義することも、シェルや環境によって事前に定義されることもある

例：環境変数

変数は、名前付きのパラメータと考えることができ、値の保存や更新が可能

### 比較と理解

- **変数はパラメータの一種**：すべての変数はパラメータですが、すべてのパラメータが変数というわけではない（位置パラメータや特別なパラメータなど）
- **パラメータはより広い概念**：パラメータという用語は、値を保持できる任意のエンティティを指す。変数だけでなく、スクリプトへの入力や特別なシェルパラメータなども含まれる

### Redirect

標準入力（stdin）、標準出力（stdout）、および標準エラー出力（stderr）のデータフローを制御する機能

### `<`（入力リダイレクト）

- **説明**: 標準入力をファイルまたは他のソースから取得
- **使用例**: `command < file`は、`file`の内容を`command`の標準入力として渡す

```bash
grep "example" < myfile.txt
```

### `>`（出力リダイレクト）

- **説明**: 標準出力をファイルに書き込む
    - ファイルが既に存在する場合は、その内容を上書きする
- **使用例**: `command > file`は、`command`の標準出力を`file`に書き込む

```bash
ls > directorylist.txt
```

### `>>`（追記リダイレクト）

- **説明**: 標準出力をファイルに追記
    - ファイルが存在しない場合は新しく作成
- **使用例**: `command >> file`は、`command`の標準出力を`file`の末尾に追記

```bash
echo "New entry" >> myfile.txt
```

### `<<`（ヒアドキュメント）

- **説明**: 標準入力として、スクリプト内に直接記述されたテキストブロックを使用
    - 終了識別子（ここでは`EOF`とする）までの全ての行がコマンドの入力として使用される
- **使用例**: `command << EOF`は、`EOF`が再び現れるまでの間、入力されたテキストを`command`の標準入力として使用

```bash
cat <<EOF
This is a line.
This is another line.
EOF
```

### 補足

- 標準エラー出力をリダイレクトするには、`2>`や`2>>`を使用します（ファイルディスクリプタ番号を指定したリダイレクト）

## expansion

### コマンドライン上で特定の文字列が特定のルールに基づいて他の文字列や値に変換されるプロセス

- 変数の値の置換、算術計算の実行、パターンマッチングなどを行う

### 1. ブレース展開（Brace Expansion）

ブレース展開は、あるパターンに対して事前に定義された一連の文字列を生成

例）

`file{1,2,3}.txt`　→　`file1.txt file2.txt file3.txt`に展開

### 2. ティルダ展開（Tilde Expansion）

ホームディレクトリを指す`~`（ティルダ）の展開

例）

`cd ~`はホームディレクトリに移動するコマンドに展開

### 3. パラメータと変数の展開

変数の値に置き換えられる

例）

`$HOME`はユーザーのホームディレクトリのパスに展開

### 4. コマンド置換（Command Substitution）

バッククォート（\`command\\`）または`$(command)`の形式を使い、あるコマンドの実行結果に置き換える

例）

`$(ls)`は`ls`コマンドの出力結果に置き換え

### 5. 算術展開（Arithmetic Expansion）

`$((expression))`の形式を使い、算術表現を評価し、その結果に置き換える

例）

`$((2+3))`は`5`に展開

### 6. ワード分割（Word Splitting）

展開の結果得られた文字列は、IFS（内部フィールドセパレータ）の値に基づいて複数の単語に分割される

### 7. パス名展開（Pathname Expansion）

ワイルドカード（例えば`*`や`?`）を含むパターンが、一致するファイル名に展開される

例）

`*.txt`はカレントディレクトリの全てのテキストファイルに展開される

### 8. クォート削除（Quote Removal）

ダブルクォート（`"`）、シングルクォート（`'`）、バックスラッシュ（`\\`）が処理され、コマンドラインから取り除かれる

→ 特定の文字をリテラルとして扱ったり、特別な意味を持つ文字のエスケープを可能にする

これらの展開は、Bashがコマンドラインを解釈する際に特定の順序で実行される

この順序は、ブレース展開から始まり、クォート削除で終わる一連のステップに従う

## $?

特別なパラメータの一つで、直前に実行されたコマンドの終了ステータス（exit status）を保持する

終了ステータスは、コマンドが成功したか失敗したかを示す数値で、通常はコマンドが成功した場合は`0`、失敗した場合は`0`以外の値を返す

### 使用例

```bash
ls /nonexistentfile
echo $?

```

存在しないファイルに対して`ls`コマンドを実行

→コマンド失敗

→終了ステータスとして`0`以外の値（多くのUnix系システムでは`2`や`1`など）が`$?`に設定される

→`echo $?`を実行すると、直前の`ls`コマンドの終了ステータスが表示される

スクリプト内でエラーハンドリングを行う際に、コマンドが予期せず失敗した場合に、適切なエラーメッセージを表示したり、代替の処理を行ったりすることが可能

シェルスクリプトやコマンドライン操作において非常に有用なツールで、プログラムの流れを制御するための条件分岐やエラーチェックに頻繁に利用される

### 参考サイト

[https://pikesaku.hatenablog.com/entry/2016/11/23/160156](https://pikesaku.hatenablog.com/entry/2016/11/23/160156)

## 参考サイト

[https://ja.manpages.org/bash](https://ja.manpages.org/bash)